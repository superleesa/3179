{
    "$schema":"https://vega.github.io/schema/vega-lite/v5.json",
    "title":{
       "text":"Countries with Top N Average Wages from 2000 to 2022",
       "font":"Roboto"
    },
    "width":900,
    "height":600,
    "data":{
       "url":"avg_wage.csv"
    },
    "params":[
       {
          "name":"TopN",
          "value":20,
          "bind":{
             "input":"range",
             "min":10,
             "max":30,
             "step":1,
             "name": "Top N"
          }
       }
    ],
    "transform":[
       {
          "sort":[
             {
                "field":"Value",
                "order":"descending"
             }
          ],
          "window":[
             {
                "op":"rank",
                "as":"rank"
             }
          ],
          "groupby":[
             "Time"
          ]
       },
       {
          "filter":"datum.rank <= TopN"
       }
    ],
    "encoding":{
       "x":{
          "field":"Time",
          "type":"ordinal",
          "sort":[
            "2000",
            "2001",
            "2002",
            "2003",
            "2004",
            "2005",
            "2006",
            "2007",
            "2008",
            "2009",
            "2010",
            "2011",
            "2012",
            "2013",
            "2014",
            "2015",
            "2016",
            "2017",
            "2018",
            "2019",
            "2020",
            "2021",
            "2022"
          ],
          "axis":{
             "labelAngle":0,
             "labelFontSize":12,
             "titleFontSize":14,
             "title":"Time",
             "titleFont":"Roboto",
             "labelFont":"Roboto"
          }
       },
       "y":{
          "field":"rank",
          "type":"quantitative",
          "sort":"descending",
          "scale":{
             "domain":[
                0.5,
                {
                   "expr":"TopN+0.5"
                }
             ]
          },
          "axis":{
            "domain": false, "grid": false, "ticks": false, "labels": false, "title": false
          }
       },
       "tooltip":[
         {
            "field":"Country",
            "type":"nominal"
         },
         {
            "field":"Time",
            "type":"ordinal"
         },
         {
            "field":"Value",
            "type":"quantitative"
         },
         {
            "field":"rank",
            "type":"quantitative"
         }
      ]
    },
    "layer":[
        {
           "mark":{
              "type":"line",
              "interpolate":"monotone",
              "strokeWidth":20
           },
           "encoding":{
              "color":{
                 "field":"Country",
                 "legend":null,
                 "condition":{
                    "test": "datum['Country'] == 'Japan'",
                    "value":  "black"
                 },
                 "scale":{
                    "scheme":"tableau20",
                    "reverse":true
                 }
              },
              "size":{
                 "condition":{
                    "param":"selected",
                    "empty":false,
                    "value":10
                 },
                 "value":8
              },
              "opacity":{
                 "condition":[{
                    "param":"clicked",
                    "empty":false,
                    "value":1
                 },
                 {
                    "test": "datum['Country'] == 'Japan'",
                    "value":  1
                 }],
                 "value":0.4
              }
           }
        },
        {
           "params":[
              {
                 "name":"selected",
                 "select":{
                    "type":"point",
                    "on":"click",
                    "fields":[
                       "Country"
                    ]
                 },
                 "bind":"legend"
              }
           ],
           "mark":{
              "type":"tick",
              "thickness":0
           },
           "encoding":{
              "color":{

                 "condition":[{
                    "param":"selected",
                    "empty":false,
                    "value":"black"
                 },{
                    "test": "datum['Country'] == 'Japan'",
                    "value":  "black"
                 }],
                 "field":"Country"
              },
              "opacity":{
                 "condition":[{
                    "param":"clicked",
                    "empty":false,
                    "value":1
                 },{
                    "test": "datum['Country'] == 'Japan'",
                    "value":  1
                 }],
                 "value":0.5
              }
           }
        },
        {
           "params":[
              {
                 "name":"clicked",
                 "select":{
                    "type":"point",
                    "fields":[
                       "Country"
                    ]
                 }
              }
           ],
           "transform":[
              {
                 "filter":{
                    "param":"clicked",
                    "empty":false
                 }
              }
           ],
           "mark":{
              "type":"text",
              "yOffset":20,
              "fontSize":20,
              "fontStyle":"bold",
              "font":"Roboto"
           },
           "encoding":{
              "text":{
                 "field":"rank"
              },
              "tooltip":[
                 {
                    "field":"Country",
                    "type":"nominal"
                 },
                 {
                    "field":"Time",
                    "type":"ordinal"
                 },
                 {
                    "field":"Value",
                    "type":"quantitative"
                 },
                 {
                    "field":"rank",
                    "type":"quantitative"
                 }
              ]
           }
        },
        {
            "transform":[
               {
                  "filter": "datum['Country'] == 'Japan'"
               }
            ],
            "mark":{
               "type":"text",
               "yOffset":-15,
               "xOffset":10,
               "fontSize":20,
               "fontStyle":"bold",
               "font":"Roboto"
            },
            "encoding":{
               "text":{
                  "field":"rank"
               },
               "color": {"value":"red"},
               "tooltip":[
                  {
                     "field":"Country",
                     "type":"nominal"
                  },
                  {
                     "field":"Time",
                     "type":"ordinal"
                  },
                  {
                     "field":"Value",
                     "type":"quantitative"
                  },
                  {
                     "field":"rank",
                     "type":"quantitative"
                  }
               ]
            }
         },
        {
           "transform":[
              {
                 "filter":{
                    "field":"Time",
                    "equal":"2022"
                 }
              }
           ],
           "mark":{
              "type":"text",
              
              "xOffset":20,
              "fontSize":15,
              "align": "left",
              "fontStyle":"bold",
              "font":"Roboto"
           },
           "encoding":{
              "text":{
                 "field":"Country"
              },
              "opacity":{
                 "condition":{
                    "param":"clicked",
                    "empty":false,
                    "value":1
                 },
                 "value":0.8
              }
           }
        },
        {
            "transform":[
               {
                  "filter":{
                     "field":"Time",
                     "equal":"2000"
                  }
               }
            ],
            "mark":{
               "type":"text",
               
               "xOffset":-20,
               "fontSize":15,
               "align": "right",
               "fontStyle":"bold",
               "font":"Roboto"
            },
            "encoding":{
               "text":{
                  "field":"Country"
               },
               "opacity":{
                  "condition":{
                     "param":"clicked",
                     "empty":false,
                     "value":1
                  },
                  "value":0.8
               }
            }
         }
     ]
 }